@using Transformer_Forecasting_Web.Data;

<MudDialog Style="@($"background:{Theme.Palette.BackgroundGrey};")">
    <DialogContent>
        Dialog Content
    </DialogContent>

    <DialogActions>
        @if (showWarning == true)
        {
            <MudAlert Severity="Severity.Warning" Variant="Variant.Filled" Class="">Must fill all boxes</MudAlert>
        }
        <MudButton OnClick="Cancel">Cancel</MudButton>        
        <MudButton Color="Color.Primary" OnClick="Submit">Ok</MudButton>
    </DialogActions>

    <DialogContent>
    <MudStack>
            <MudPaper Class="pa-4">
            <MudText Typo="Typo.body1">Model</MudText>
            <MudSelect T="string" Label="Pick a model" @bind-Value="model">
                <MudSelectItem T="string" Value="@("DTP")" />
                <MudSelectItem T="string" Value="@("LFP")" />
            </MudSelect>
        </MudPaper>

        <MudPaper Class="pa-4">
            <MudText Typo="Typo.body1">Period Description</MudText>
            <MudTextField  Lines="3" @bind-Value="periodDescription" Label="Describe the period" Variant="Variant.Text" />
        </MudPaper>
    </MudStack>
    </DialogContent>

</MudDialog>




@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    private bool visibility = false;
    private string model = "";
    private string periodDescription = "";
    bool showWarning = false;
    int id = 1; //Should be changed to fit with database

    Prediction prediction = new Prediction();
    private MudTheme Theme = new MudTheme();


    void Submit()
    {
        prediction = new Prediction(id, model, periodDescription, new double[] { 1, 5, 3, 4, 2, 5 }, new double[] { 7, 6, 4, 2, 3, 4 }); //insert predicted values here
        id++;
        if(prediction.Model != "" && prediction.PeriodDescription != "")
        {
            GlobalJsonBuilder.jsonBuilder.AddParam(("model", model));
            GlobalJsonBuilder.jsonBuilder.AddParam(("periodDescription", periodDescription));
            GlobalJsonBuilder.jsonBuilder.BuildJson();
            GlobalJsonBuilder.jsonBuilder.ResetParam();
            //modelExecution.RunPythonScript(); This runs model. Remove comment when done
            MudDialog.Close(DialogResult.Ok(true));
        }
        else
        {
            showWarning = true;
        }
    }
    void Cancel() => MudDialog.Cancel();
}